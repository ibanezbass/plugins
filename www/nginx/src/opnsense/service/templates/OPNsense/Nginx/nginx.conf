{# load naxsi WAF module #}
load_module /usr/local/libexec/nginx/ngx_stream_module.so;
load_module /usr/local/libexec/nginx/ngx_http_naxsi_module.so;
load_module /usr/local/libexec/nginx/ngx_mail_module.so;
load_module /usr/local/libexec/nginx/ngx_http_brotli_filter_module.so;
load_module /usr/local/libexec/nginx/ngx_http_brotli_static_module.so;
load_module /usr/local/libexec/nginx/ngx_http_js_module.so;

user www staff;
{% if OPNsense.Nginx.http.workerprocesses is defined and OPNsense.Nginx.http.workerprocesses != '' %}
worker_processes {{ OPNsense.Nginx.http.workerprocesses }};
{% else %}
worker_processes  1;
{% endif %}

error_log  /var/log/nginx/error.log;

events {
    {% if OPNsense.Nginx.http.workerconnections is defined and OPNsense.Nginx.http.workerconnections != '' %}
    worker_connections  {{ OPNsense.Nginx.http.workerconnections }};
    {% else %}
    worker_connections 1024;
    {% endif %}
}

http {
{% if helpers.exists('OPNsense.Nginx') %}
{#   include http blocks partial #}
{%   include "OPNsense/Nginx/http.conf" %}
{% endif %}
}
{% if helpers.exists('OPNsense.Nginx') %}
stream {
{#   include streams blocks partial #}
{%   include "OPNsense/Nginx/streams.conf" %}
}
# mail {
{#   include http blocks partial #}
{%   include "OPNsense/Nginx/mail.conf" ignore missing with context %}
# }
{% endif %}
